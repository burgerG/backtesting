<script>
    let closeValues = [102997.47, 105996.60, 104719.64, 102282.11, 103372.41, 101301.29, 103891.84, 101590.52, 106547.52, 110639.63, 110064.02, 109556.16, 108305.55, 110055.30, 112956.17, 114119.32, 114472.44, 111641.73, 111033.92, 110069.72, 107688.59, 108476.89, 110588.93, 108666.71, 107198.27, 106467.79, 108186.04, 110783.17, 113118.67, 115271.08, 115169.76, 110807.88, 113214.37, 121705.58, 123354.87, 121451.38, 124752.53, 123513.47, 122425.43, 122266.53, 120681.26, 118648.93, 114056.08, 114400.39, 112122.64, 109681.94, 109712.83, 109049.29, 113328.63, 112014.50, 112748.51, 115306.10, 115721.96, 115688.86, 117137.20, 116468.51, 116843.18, 115444.87, 115407.65, 115950.51, 116101.58, 115507.54, 113955.36, 111530.55, 112071.43, 111167.62, 110224.70, 110650.99, 110723.60, 111723.21, 111200.59, 109250.59, 108236.71, 108808.07, 108410.84, 112544.80, 111222.06, 111802.66, 110124.35, 113458.43, 115374.33, 116874.09, 112419.03, 114274.74, 112831.18, 116252.31, 117453.06, 117491.35, 117398.35, 118359.58, 123344.06, 120172.91, 118731.45, 119306.76, 116500.36, 116688.73, 117496.90, 115028.00, 114141.44, 115071.88, 114217.67, 112526.91, 113320.09, 115758.20, 117831.19, 117922.15, 117924.47, 119448.49, 117947.37, 117635.88, 118368.00, 118754.96, 119995.42, 117439.54, 117300.79, 117939.98, 118003.22, 119289.84, 118738.51, 117777.19, 119849.71, 119116.12, 117435.23, 117516.99, 115987.21, 111326.55, 108950.28, 108299.85, 109232.07, 108231.18, 108034.34, 109647.98, 108859.32, 105698.28, 107135.33, 108385.57, 107327.70, 107088.43, 106960.00, 107361.26, 106045.63, 105577.77, 100987.14, 102257.41, 103309.60, 104684.29, 104883.33, 104601.12, 106796.76, 105552.03, 105472.41, 106090.97, 105929.05, 108686.63, 110257.24, 110294.10, 105793.65, 105615.63, 104390.35, 101575.95, 104731.98, 105432.47, 105881.53, 105652.10, 104638.09, 103998.57, 105641.76, 107802.32, 108994.64, 109440.37, 109035.39, 107791.16, 107287.80, 111673.28, 109678.08, 106791.09, 105606.18, 106446.01, 103191.09, 103489.29, 103744.64, 103539.42, 104169.81, 102812.95, 104106.36, 104696.33, 102970.85, 103241.46, 97032.32, 96802.48, 94748.05, 94315.97, 95891.80, 96910.07, 96492.34, 94207.31, 94284.79, 94978.75, 93754.85, 94646.93, 94720.50, 93943.79, 93699.11, 93441.89, 87518.91, 85174.30, 85063.41, 84450.81, 84895.75, 84033.87, 83668.99, 84542.39, 83684.98, 85287.11, 83404.84, 79626.14, 82573.95, 76271.95, 79235.33, 78214.48, 83504.80, 83843.80, 83102.83, 82485.71, 85169.17, 82548.91, 82334.52, 82597.58, 84353.15, 87177.10, 86900.89, 87471.70, 87498.91, 86054.37, 83832.49, 84043.25, 84167.19, 86854.23, 82718.50, 84075.69, 82579.69, 84343.11, 83969.10, 81066.70, 83722.36, 82862.21, 78532.00, 80601.04, 86154.59, 86742.68, 89961.73, 90623.56, 87222.19, 86065.67, 94248.35, 86031.91, 84373.01, 84704.22, 84347.02, 88736.17, 91418.17, 96273.92, 96577.76, 96125.54, 98333.94, 96635.61, 95539.54, 95773.38, 96175.03, 97580.35, 97508.97, 96623.87, 97885.86, 95747.43, 97437.56, 96500.09, 96482.45, 96529.08, 96593.30, 96615.44, 97871.82, 101405.42, 97688.98, 100655.91, 102405.03, 104735.30, 103703.21, 101332.48, 102087.69, 102682.50, 104714.65, 104819.48, 103960.17, 103653.07, 106146.26, 102016.66, 101089.61, 104408.07, 104462.04, 99756.91, 100504.49, 96534.04, 94516.53, 94488.44, 94566.59, 94701.46, 92484.04, 95043.52, 96922.71, 102078.09, 98314.96, 98236.23, 98107.43, 96886.88, 94419.76, 93429.20, 92643.21, 93530.23, 95163.93, 94164.86, 95795.52, 99299.19, 98676.10, 94686.24, 95104.93, 97224.73, 97755.93, 97490.95, 100041.54, 106140.60, 106029.72, 104298.70, 101372.97, 101459.25, 100043.00, 101173.03, 96675.43, 97432.72, 101236.01, 99923.34, 99920.71, 96593.57, 98768.53, 96002.16, 95865.30, 97279.79, 96449.06, 97461.52, 95652.47, 95962.53, 91985.32, 93102.30, 98013.82, 97777.28, 98997.66, 98504.73, 94339.50, 92343.79, 90542.64, 89845.85, 90558.48, 91066.01, 87250.43, 90584.17, 87955.81, 88701.49, 80474.19, 76778.87, 76545.48, 75904.86, 75639.08, 69359.57, 67811.51, 68741.12, 69289.28, 69482.47, 70215.19, 72339.54, 72720.49, 69907.75, 67929.30, 67014.70, 66642.41, 68161.05, 66432.20, 67361.40, 67367.85, 69001.71, 68362.73, 68418.79, 67399.83, 67612.72, 67041.11, 66046.13, 62851.37, 63193.02, 62445.09, 60274.50].reverse()



    function displayCloseValuesWithDetailedAnalysis() {
    if (typeof closeValues === 'undefined' || !Array.isArray(closeValues) || closeValues.length === 0) {
        console.error('Invalid closeValues array');
    return;
    }

    const earningRate = 1 + (1.4 / 100);
    let previousValue = closeValues[0];
    let buyValue = 100;

    let currentConsecutiveCount = 0;
    let maxConsecutiveCount = 0;
    let currentConsecutiveSum = 0;
    let maxConsecutiveSum = 0;

    // Arrays to track history
    const buyValues = [buyValue];
    const failureDays = [];
    const consecutiveSums = []; // Track current consecutive sum for each failure day

    const container = document.createElement('div');
    container.className = 'analysis-container';
    document.body.appendChild(container);

    // Header with key metrics
    const header = document.createElement('div');
    header.className = 'header';
    header.innerHTML = `
    <div class="metric">Days: ${closeValues.length}</div>
    <div class="metric">Rate: ${((earningRate - 1) * 100).toFixed(2)}%</div>
    <div class="metric">Initial: $100</div>
    `;
    container.appendChild(header);

    // Create compact grid for days
    const daysGrid = document.createElement('div');
    daysGrid.className = 'days-grid';
    container.appendChild(daysGrid);

    // First day
    const firstDay = document.createElement('div');
    firstDay.className = 'day-card neutral';
    firstDay.innerHTML = `
    <div class="day-number">1</div>
    <div class="close-value">${closeValues[0].toFixed(0)}</div>
    <div class="buy-value">${buyValue.toFixed(0)}</div>
    <div class="status">INIT</div>
    `;
    daysGrid.appendChild(firstDay);

    // Process remaining days
    for (let i = 1; i < closeValues.length; i++) {
        const currentValue = closeValues[i];
    buyValue *= earningRate;
    buyValues.push(buyValue);

    const dayCard = document.createElement('div');
    dayCard.className = 'day-card';
        
        const meetsCondition = currentValue >= previousValue * earningRate;
    const conditionPercentage = ((currentValue - previousValue) / previousValue * 100).toFixed(1);

    if (meetsCondition) {
        dayCard.classList.add('condition-met');
    currentConsecutiveCount = 0;
    currentConsecutiveSum = 0;
        } else {
        dayCard.classList.add('condition-failed');
    currentConsecutiveCount++;
    currentConsecutiveSum += buyValue;
    consecutiveSums.push({day: i + 1, sum: currentConsecutiveSum});
    maxConsecutiveCount = Math.max(maxConsecutiveCount, currentConsecutiveCount);
    maxConsecutiveSum = Math.max(maxConsecutiveSum, currentConsecutiveSum);
    failureDays.push(i + 1);
        }

    dayCard.innerHTML = `
    <div class="day-number">${i + 1}</div>
    <div class="close-value">${currentValue.toFixed(0)}</div>
    <div class="buy-value">${buyValue.toFixed(0)}</div>
    <div class="change ${meetsCondition ? 'positive' : 'negative'}">${conditionPercentage}%</div>
    <div class="status">${meetsCondition ? '✓' : `✗ ${currentConsecutiveSum.toFixed(0)}`}</div>
    `;

    // Add tooltip for more details
    dayCard.title = `Day ${i + 1}\nClose: ${currentValue.toFixed(2)}\nBuy: ${buyValue.toFixed(2)}\nChange: ${conditionPercentage}%\nStatus: ${meetsCondition ? 'MET' : 'FAILED'}`;

    daysGrid.appendChild(dayCard);
    previousValue = currentValue;
    }

    // Compact results panel
    const resultsPanel = document.createElement('div');
    resultsPanel.className = 'results-panel';
    resultsPanel.innerHTML = `
    <div class="results-grid">
        <div class="result-item">
            <div class="result-label">Max Fail Streak</div>
            <div class="result-value">${maxConsecutiveCount} days</div>
        </div>
        <div class="result-item">
            <div class="result-label">Max Fail Sum</div>
            <div class="result-value">${maxConsecutiveSum.toFixed(0)}</div>
        </div>
        <div class="result-item">
            <div class="result-label">Final Value</div>
            <div class="result-value">${buyValue.toFixed(0)}</div>
        </div>
        <div class="result-item">
            <div class="result-label">Total Return</div>
            <div class="result-value ${buyValue >= 100 ? 'positive' : 'negative'}">${((buyValue - 100) / 100 * 100).toFixed(1)}%</div>
        </div>
    </div>
    ${failureDays.length > 0 ? `
            <div class="failure-summary">
                <strong>Failure Days:</strong> ${failureDays.join(', ')}
            </div>
        ` : ''}
    `;
    container.appendChild(resultsPanel);

    return {
        maxConsecutiveFailures: maxConsecutiveCount,
    maxConsecutiveSum: maxConsecutiveSum,
    finalBuyValue: buyValue,
    totalReturn: buyValue - 100,
    failureDays: failureDays,
    buyValues: buyValues,
    consecutiveSums: consecutiveSums
    };
}

    // Dark mode CSS
    const style = document.createElement('style');
    style.textContent = `
    body {
        background: #1a1a1a;
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    line-height: 1.4;
    }

    .analysis-container {
        max - width: 1200px;
    margin: 0 auto;
    }

    .header {
        display: flex;
    gap: 20px;
    margin-bottom: 20px;
    padding: 15px;
    background: #2d2d2d;
    border-radius: 8px;
    border: 1px solid #404040;
    }

    .metric {
        padding: 8px 16px;
    background: #404040;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9em;
    }

    .days-grid {
        display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 8px;
    margin-bottom: 20px;
    }

    .day-card {
        padding: 10px;
    border-radius: 6px;
    text-align: center;
    font-size: 0.8em;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    background: #2d2d2d;
    }

    .day-card:hover {
        transform: translateY(-2px);
    border-color: #555;
    }

    .day-number {
        font - weight: bold;
    font-size: 0.9em;
    margin-bottom: 4px;
    color: #888;
    }

    .close-value {
        font - size: 1em;
    font-weight: 600;
    margin-bottom: 2px;
    }

    .buy-value {
        font - size: 0.8em;
    color: #aaa;
    margin-bottom: 2px;
    }

    .change {
        font - size: 0.75em;
    font-weight: 600;
    margin-bottom: 2px;
    }

    .change.positive {
        color: #4ade80;
    }

    .change.negative {
        color: #f87171;
    }

    .status {
        font - size: 0.8em;
    font-weight: bold;
    margin-top: 2px;
    }

    .condition-met {
        background: #1e3a2a;
    border-color: #2d5a3a;
    }

    .condition-failed {
        background: #3a1e1e;
    border-color: #5a2d2d;
    }

    .neutral {
        background: #2d2d3a;
    border-color: #3a3a4a;
    }

    .results-panel {
        background: #2d2d2d;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #404040;
    }

    .results-grid {
        display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
    }

    .result-item {
        text - align: center;
    padding: 12px;
    background: #404040;
    border-radius: 6px;
    }

    .result-label {
        font - size: 0.8em;
    color: #aaa;
    margin-bottom: 4px;
    }

    .result-value {
        font - size: 1.2em;
    font-weight: bold;
    }

    .result-value.positive {
        color: #4ade80;
    }

    .result-value.negative {
        color: #f87171;
    }

    .failure-summary {
        font - size: 0.85em;
    color: #ccc;
    padding-top: 10px;
    border-top: 1px solid #404040;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .days - grid {
        grid - template - columns: repeat(auto-fill, minmax(100px, 1fr));
        }

    .header {
        flex - direction: column;
    gap: 10px;
        }

    .results-grid {
        grid - template - columns: repeat(2, 1fr);
        }
    }
    `;
    document.head.appendChild(style);

    // Call the function
    const detailedAnalysis = displayCloseValuesWithDetailedAnalysis();
    console.log('Detailed Analysis:', detailedAnalysis);
</script>
